    public function enqueue_frontend_booking_assets() {
        // Only load on pages with Booknetic booking panel
        if (!is_admin() && (has_shortcode(get_the_content(), 'booknetic') || isset($_GET['booknetic']))) {
            
            $js_file = BKNTCCS_PLUGIN_URL . 'assets/js/frontend-booking-collaborative.js';
            
            wp_enqueue_script(
                'bkntc-collab-frontend-booking',
                $js_file,
                ['jquery'],
                time(), // Use timestamp for development, version number for production
                true
            );
            
            wp_localize_script('bkntc-collab-frontend-booking', 'BookneticCollabFrontend', [
                'ajaxurl' => admin_url('admin-ajax.php'),
                'nonce' => wp_create_nonce('bkntc_collab_frontend_nonce')
            ]);
            
            if (function_exists('bkntc_cs_log')) {
                bkntc_cs_log('Frontend booking assets enqueued');
            }
        }
    }
    
    public function ajax_get_frontend_category_rules() {
        // Allow both logged-in and non-logged-in users
        if (!check_ajax_referer('bkntc_collab_frontend_nonce', 'nonce', false)) {
            wp_send_json_error(['message' => 'Invalid nonce']);
            return;
        }
        
        $service_id = isset($_POST['service_id']) ? intval($_POST['service_id']) : 0;
        
        if (!$service_id) {
            wp_send_json_error(['message' => 'Service ID required']);
            return;
        }
        
        global $wpdb;
        
        // Get service category
        $service_table = $wpdb->prefix . 'bkntc_services';
        $category_id = $wpdb->get_var($wpdb->prepare(
            "SELECT category_id FROM {$service_table} WHERE id = %d",
            $service_id
        ));
        
        if (!$category_id) {
            wp_send_json_success([
                'min' => null,
                'max' => null,
                'message' => 'No category found for service'
            ]);
            return;
        }
        
        // Get category rules from options
        $rules_key = 'bkntc_cs_category_rules_' . $category_id;
        $rules = get_option($rules_key, []);
        
        // Fallback: check database columns
        if (empty($rules)) {
            $categories_table = $wpdb->prefix . 'bkntc_service_categories';
            $category_data = $wpdb->get_row($wpdb->prepare(
                "SELECT collab_min_staff, collab_max_staff, collab_eligible_staff 
                 FROM {$categories_table} WHERE id = %d",
                $category_id
            ), ARRAY_A);
            
            if ($category_data) {
                $rules = [
                    'min' => !empty($category_data['collab_min_staff']) ? intval($category_data['collab_min_staff']) : null,
                    'max' => !empty($category_data['collab_max_staff']) ? intval($category_data['collab_max_staff']) : null,
                    'eligible_staff' => !empty($category_data['collab_eligible_staff']) 
                        ? json_decode($category_data['collab_eligible_staff'], true) 
                        : []
                ];
            }
        }
        
        wp_send_json_success([
            'min' => isset($rules['min']) ? intval($rules['min']) : null,
            'max' => isset($rules['max']) ? intval($rules['max']) : null,
            'eligible_staff' => isset($rules['eligible_staff']) ? $rules['eligible_staff'] : [],
            'category_id' => $category_id
        ]);
    }

